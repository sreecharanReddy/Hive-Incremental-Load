create view Admission_vw as
select AdmissionId,AdmissionDate,AdmissionKnownToId,AdmissionKnownToName,AdmissionModeId,AdmissionNumber,AdmissionReasonId,AdmissionRemarks,AdmissionTypeCode,AdmittingConsultantId,BedId,BillingClassId,ChiefComplaint,ConcessionRemarks,CreatedById,CreatedTime,CurrentBedId,DeleteComments,DiagnosisId,DietId,DischargeDate,DischargeStatusId,EligibleBillingClassId,EntitlementId,ExpectedDischargeDate,ExpectedLOS,FolioRemarks,HospitalId,ICDId,InitialAdmittingConsultantId,InitialTreatingConsultantId,InstituteId,IsActive,JointConsultantId,LastUpdatedTime,MotherAdmissionNumber,PatientId,PatientSponsorId,PaymentTypeId,ReferenceFile,TreatingConsultantId,TreatmentTypeId,TriageDetailId,UpdatedById from
(select *, ROW_NUMBER() OVER(Partition by AdmissionId ORDER BY modified_date desc) As rnk from
(select AdmissionId,'INSERT' as header__operation,cast('1900-01-01' as timestamp) as modified_date,AdmissionDate,AdmissionKnownToId,AdmissionKnownToName,AdmissionModeId,AdmissionNumber,AdmissionReasonId,AdmissionRemarks,AdmissionTypeCode,AdmittingConsultantId,BedId,BillingClassId,ChiefComplaint,ConcessionRemarks,CreatedById,CreatedTime,CurrentBedId,DeleteComments,DiagnosisId,DietId,DischargeDate,DischargeStatusId,EligibleBillingClassId,EntitlementId,ExpectedDischargeDate,ExpectedLOS,FolioRemarks,HospitalId,ICDId,InitialAdmittingConsultantId,InitialTreatingConsultantId,InstituteId,IsActive,JointConsultantId,LastUpdatedTime,MotherAdmissionNumber,PatientId,PatientSponsorId,PaymentTypeId,ReferenceFile,TreatingConsultantId,TreatmentTypeId,TriageDetailId,UpdatedById from Admission
UNION ALL
select AdmissionId,header__operation,cast(date_format(header__timestamp, 'yyyy-MM-dd HH:mm:ss') as timestamp) as modified_date,AdmissionDate,AdmissionKnownToId,AdmissionKnownToName,AdmissionModeId,AdmissionNumber,AdmissionReasonId,AdmissionRemarks,AdmissionTypeCode,AdmittingConsultantId,BedId,BillingClassId,ChiefComplaint,ConcessionRemarks,CreatedById,CreatedTime,CurrentBedId,DeleteComments,DiagnosisId,DietId,DischargeDate,DischargeStatusId,EligibleBillingClassId,EntitlementId,ExpectedDischargeDate,ExpectedLOS,FolioRemarks,HospitalId,ICDId,InitialAdmittingConsultantId,InitialTreatingConsultantId,InstituteId,IsActive,JointConsultantId,LastUpdatedTime,MotherAdmissionNumber,PatientId,PatientSponsorId,PaymentTypeId,ReferenceFile,TreatingConsultantId,TreatmentTypeId,TriageDetailId,UpdatedById from Admission__ct
where header__operation!='BEFOREIMAGE') t2
)A
where Rnk=1
AND header__operation!='DELETE';